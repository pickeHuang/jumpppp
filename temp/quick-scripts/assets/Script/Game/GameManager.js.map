{"version":3,"sources":["GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../assets/Script/Game","sourcesContent":["import { GameData } from \"./GameData\";\n\n/*\n    游戏管理类  单例类\n*/\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport class GameManager extends cc.Component {\n\n    private static instance: GameManager = null;\n\n    public static get Instance(): GameManager {\n        if (!GameManager.instance) {\n            GameManager.instance = new GameManager();\n        }\n        return GameManager.instance;\n    }\n\n    private data: GameData = null;\n    //游戏是否开始\n    public isGameStarted: boolean = null;\n\n    //游戏是否结束\n    public isGameOver: boolean = null;\n\n    //玩家是否开始移动\n    public playerIsMove: boolean = null;\n\n    //玩家是否暂停游戏\n    public isPause: boolean = null;\n\n    //游戏成绩\n    private gameScore: number = null;\n\n    private isFirstGame: boolean = null;\n    private isMusicOn: boolean = null;\n    private bestScoreArr: number[] = [];\n\n\n    //初始化\n    onLoad() {\n\n        cc.game.addPersistRootNode(this.node);\n\n        if (GameData.IsAgainGame) {\n            this.IsGameStarted = true;\n        }\n        this.initGameData();\n\n    }\n    onDestroy() {\n\n    }\n    //保存成绩\n    public SaveScore(score: number) {\n\n        //let list: Array<number> = this.bestScoreArr;\n        this.bestScoreArr.sort((a, b) => {\n            return b - a;\n        });\n\n        let index: number = -1;\n        for (let i = 0; i < this.bestScoreArr.length; i++) {\n            if (score > this.bestScoreArr[i]) {\n                index = i;\n            }\n        }\n        if (index == -1) return;\n        for (let i = this.bestScoreArr.length - 1; i > index; i--) {\n            this.bestScoreArr[i] - this.bestScoreArr[i - 1];\n        }\n        this.bestScoreArr[index] = score;\n\n        //this.Save();\n    }\n\n    //获取成绩最高分\n    public GetBestScore(): number {\n        let bestScore = Math.max.call(this.bestScoreArr);\n        return bestScore;\n    }\n\n    //获取成绩最高分数组\n    public GetScoreArr(): number[] {\n\n        this.bestScoreArr.sort((a, b) => {\n            return b - a;\n        });\n        return this, this.bestScoreArr;\n    }\n\n    //玩家移动会调用此方法\n    private PlayerMove(): void {\n\n        this.playerIsMove = true;\n    }\n\n    //增加游戏成绩\n    public AddGameScore(): void {\n        if (this.isGameStarted == false || this.isGameOver || this.isPause) return;\n        this.gameScore++;\n\n    }\n\n    //获取游戏成绩\n    public GetGameScore(): number {\n        return this.gameScore;\n    }\n\n    private initGameData(): void {\n\n        if (this.data != null) {\n            this.isFirstGame = this.data.IsFirstGame;\n        } else {\n            this.isFirstGame = true;\n        }\n        //如果是第一次玩游戏\n        if (this.isFirstGame) {\n            this.isFirstGame = false;\n            this.isMusicOn = true;\n            this.bestScoreArr = [1,2,3];\n\n            this.data = new GameData();\n            //保存数据\n            //this.Save();\n        } else {\n\n        }\n    }\n\n    //存储数据\n    private Save(): void {\n        try {\n\n            cc.sys.localStorage.setItem(\"bestscoreArr\", this.bestScoreArr);\n            cc.sys.localStorage.setItem(\"isFirstGame\", this.isFirstGame);\n            cc.sys.localStorage.setItem(\"isMusic\", this.isMusicOn);\n        }\n        catch (err) {\n            console.log(\"消息异常\", err);\n        }\n    }\n\n    //读取数据\n    private Read(): void {\n\n        try {\n\n          this.bestScoreArr =  cc.sys.localStorage.getItem(\"bestscoreArr\");\n          this.isFirstGame =  cc.sys.localStorage.getItem(\"isFirstGame\");\n          this.isMusicOn =  cc.sys.localStorage.getItem(\"isMusic\");\n\n        } catch (error) {\n\n            console.log(\"读取失败\", error);\n        }\n    }\n\n    //重置数据\n    public ResetData(): void {\n\n        this.isFirstGame = false;\n        this.isMusicOn = true;\n        this.bestScoreArr = new Number[3];\n\n        //this.Save();\n    }\n\n    //set get\n    set IsMusicOn(value: boolean) { this.isMusicOn = value; }\n    get IsMusicOn() { return this.isMusicOn; }\n\n    set IsGameOver(value: boolean) { this.IsGameOver = value; }\n    get IsGameOver() { return this.IsGameOver; }\n\n    set PlayerIsMove(value: boolean) { this.PlayerIsMove = value; }\n    get PlayerIsMove() { return this.PlayerIsMove; }\n\n    set IsGameStarted(value: boolean) { this.IsGameStarted = value; }\n    get IsGameStarted() { return this.IsGameStarted; }\n\n    set IsPause(value: boolean) { this.isPause = value; }\n    get IsPause() { return this.isPause; }\n\n}"]}